## 3. patrol-service

### Функционал сервиса:

Сеанс обхода
* При создании сеанса обхода автоматически создаются записи о каждом студенте в подъезде, статус каждого студента - не проверен, статус обхода - в процессе. Совершеннолетние студенты не заносятся в таблицу обходов. Данные о проживании берутся из микросервиса
* В процессе обхода записи о студенте в подъезде будут вноситься данные о том, находится ли студент в комнате и, если его нет, причина отсутствия (причем необходимо это автоматически связать с микросервисом документов, чтобы автоматически проставлять отсутствие и причину)
* В конце обхода изменяется статус обхода на завершенный

Эндпоинты:

`/patrols`

* GET - возвращает все обходы
* POST - создает новый сеанс обхода и записи студентов для проверки

`/patrols/{patrolId}`

* GET - возвращает состояние обхода (в т. ч. студентов для проверки)
* POST - добавляет запись студента для проверки (в случае неактуальных данных)
* PUT - обновляет состояние обхода (завершить обход)
* DELETE - удаляет сеанс обхода (при ошибках и т. п.)

`/patrols/{patrolId}/{patrolEntryId}`

* GET - возвращает состояние записи проверяемого студента
* PUT - обновляет состояние студента (отметить присутствие/отсутствие)
* DELETE - удалить запись студента (в случае неактуальных данных)

Нужные контракты

* Все студенты (по корпусам, подъездам, совершеннолетние)
* 

База данных: `patrol_db`

### 3.1 Таблица `patrols`

Сеанс обхода — одна запись на один обход одного подъезда за вечер.

| Столбец        | Тип                        | Nullable | Описание                                                                            |
| -------------- | -------------------------- | -------- | ----------------------------------------------------------------------------------- |
| `patrol_id`           | `UUID`                     | NO       | PK. Идентификатор обхода                                                            |
| `date`         | `DATE`                     | NO       | Дата обхода                                                                         |
| `building`     | `VARCHAR(5)`               | NO       | Корпус (`"8"` или `"9"`)                                                            |
| `entrance`     | `INTEGER`                  | NO       | Подъезд (1–4)                                                                       |
| `status`       | `VARCHAR(20)`              | NO       | Статус обхода: `in_progress`, `completed`                                           |
| `started_at`   | `TIMESTAMP WITH TIME ZONE` | NO       | Время начала обхода                                                                 |
| `submitted_at` | `TIMESTAMP WITH TIME ZONE` | YES      | Время сдачи таблицы обхода                                                          |
| `created_at`   | `TIMESTAMP WITH TIME ZONE` | NO       | Дата создания записи                                                                |
| `updated_at`   | `TIMESTAMP WITH TIME ZONE` | NO       | Дата последнего обновления                                                          |

### 3.2 Таблица `patrol_entries`

Запись об одной комнате в рамках обхода.

| Столбец          | Тип                        | Nullable | Описание                                                  |
| ---------------- | -------------------------- | -------- | --------------------------------------------------------- |
| `patrol_entry_id`             | `UUID`                     | NO       | PK. Идентификатор записи                                  |
| `patrol_id`      | `UUID`                     | NO       | FK → `patrols.id`. Идентификатор обхода                   |
| `room`           | `VARCHAR(10)`              | NO       | Номер комнаты                                             |
| `user_id`        | `UUID`                     | NO       | UUID проверяемого студента                                |
| `is_present`     | `BOOLEAN`                  | YES      | Находится ли студент в комнате (`null` — ещё не проверен) |
| `absence_reason` | `TEXT`                     | YES      | Причина отсутствия (если известна)                        |
| `checked_at`     | `TIMESTAMP WITH TIME ZONE` | YES      | Время проверки комнаты                                    |
| `created_at`     | `TIMESTAMP WITH TIME ZONE` | NO       | Дата создания записи                                      |
| `updated_at`     | `TIMESTAMP WITH TIME ZONE` | NO       | Дата последнего обновления                                |

---

